(in-package :net.polyforms.lisp)

(defvar *test-holidays-list*
  (make-days-list
   `(((11 10 2006) 0.0 "Working Holiday")
     ((12 25 2006) 1.0 "Day Off Holiday")
     ((12 26 2006) 1.0 "Day Off Holiday"))))

(defvar *test-vacation-days-list*
  (make-days-list
   `(((12 27 2006) 1.0 "Vacation Day")
     ((12 28 2006) 1.0 "Vacation Day")
     ((12 29 2006) 1.0 "Vacation Day"))))

(deftest test-full-day-in-days-list-p ()
  (check
   (equal (full-day-in-days-list? *test-vacation-days-list* 732625) nil)
   (equal (full-day-in-days-list? *test-vacation-days-list* 732656) nil)
   (equal (full-day-in-days-list? *test-vacation-days-list* 732669) nil)
   (equal (full-day-in-days-list? *test-vacation-days-list* 732670) nil)
   (equal (full-day-in-days-list? *test-vacation-days-list* 732672) t)
   (equal (full-day-in-days-list? *test-holidays-list* '(11 10 2006)) nil)
   (equal (full-day-in-days-list? *test-holidays-list* '(12 11 2006)) nil)
   (equal (full-day-in-days-list? *test-holidays-list* '(12 24 2006)) nil)
   (equal (full-day-in-days-list? *test-holidays-list* '(12 25 2006)) t)
   (equal (full-day-in-days-list? *test-holidays-list* '(12 27 2006)) nil)
   (equal (full-day-in-days-list? *test-holidays-list* (today))
          (full-day-in-days-list? *test-holidays-list*))))

(deftest test-dave-holiday-p ()
  (let ((*holidays-list* *test-holidays-list*)
        (*vacation-days-list* *test-vacation-days-list*))
    (check
     (equal (dave-holiday-p 732625) nil)
     (equal (dave-holiday-p 732656) nil)
     (equal (dave-holiday-p 732669) nil)
     (equal (dave-holiday-p 732670) t)
     (equal (dave-holiday-p 732671) t)
     (equal (dave-holiday-p '(11 10 2006)) nil)
     (equal (dave-holiday-p '(12 11 2006)) nil)
     (equal (dave-holiday-p '(12 24 2006)) nil)
     (equal (dave-holiday-p '(12 25 2006)) t)
     (equal (dave-holiday-p '(12 26 2006)) t)
     (equal (dave-holiday-p) (dave-holiday-p (today))))))

(deftest test-intuit-holiday-p ()
  (let ((*holidays-list* *test-holidays-list*)
        (*vacation-days-list* *test-vacation-days-list*))
    (check
     (equal (dave-holiday-p 732625) nil)
     (equal (dave-holiday-p 732656) nil)
     (equal (dave-holiday-p 732669) nil)
     (equal (dave-holiday-p 732670) t)
     (equal (dave-holiday-p 732671) t)
     (equal (dave-holiday-p '(11 10 2006)) nil)
     (equal (dave-holiday-p '(12 11 2006)) nil)
     (equal (dave-holiday-p '(12 24 2006)) nil)
     (equal (dave-holiday-p '(12 25 2006)) t)
     (equal (dave-holiday-p '(12 26 2006)) t)
     (equal (dave-holiday-p) (dave-holiday-p (today))))))

(deftest test-dave-work-day-p ()
  (let ((*holidays-list* *test-holidays-list*)
        (*vacation-days-list* *test-vacation-days-list*))
    (check
     (equal (dave-work-day-p 732625) t)
     (equal (dave-work-day-p 732656) t)
     (equal (dave-work-day-p 732669) nil)
     (equal (dave-work-day-p 732670) nil)
     (equal (dave-work-day-p 732672) nil)
     (equal (dave-work-day-p '(11 10 2006)) t)
     (equal (dave-work-day-p '(12 11 2006)) t)
     (equal (dave-work-day-p '(12 24 2006)) nil)
     (equal (dave-work-day-p '(12 25 2006)) nil)
     (equal (dave-work-day-p '(12 27 2006)) nil)
     (equal (dave-work-day-p) (dave-work-day-p (today))))))

(deftest test-intuit-work-day-p ()
  (let ((*holidays-list* *test-holidays-list*)
        (*vacation-days-list* *test-vacation-days-list*))
    (check
     (equal (intuit-work-day-p 732625) nil)
     (equal (intuit-work-day-p 732656) t)
     (equal (intuit-work-day-p 732669) nil)
     (equal (intuit-work-day-p 732670) nil)
     (equal (intuit-work-day-p 732672) t)
     (equal (intuit-work-day-p '(11 10 2006)) nil)
     (equal (intuit-work-day-p '(12 11 2006)) t)
     (equal (intuit-work-day-p '(12 24 2006)) nil)
     (equal (intuit-work-day-p '(12 25 2006)) nil)
     (equal (intuit-work-day-p '(12 27 2006)) t)
     (equal (intuit-work-day-p) (intuit-work-day-p (today))))))
